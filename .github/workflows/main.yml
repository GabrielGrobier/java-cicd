name: proyecto-java
on:
    push:
        branches:
            - main
jobs:
    build:
        runs-on: ubuntu-latest 
        steps:

            - name: Comprobar y obtener codigo 
              uses: actions/checkout@v4

            - name: Crear carpeta en AWS 
              uses: appleboy/ssh-action@v1
              with:
                    host: ${{ secrets.IP_SERVER }}
                    username: ${{ secrets.USERNAME  }}
                    key: ${{ secrets.KEY }}
                    port: ${{ secrets.PORT }}
                    script: |
                            mkdir -p /home/ubuntu/java
            


            - name: Sincronizar proyecto en el servidor 
              uses: burnett01/rsync-deployments@7.0.2
              with:
                switches: "-avz --delete"
                path: "./"
                remote_host: ${{ secrets.IP_SERVER }}
                remote_user: ${{ secrets.USERNAME  }}
                rmeote_path: "/home/ubuntu/java"
                remote_key: ${{ secrets.KEY }}
                remote_port: ${{ secrets.PORT }}


            - name: Levantar docker con docker compose 
              uses: appleboy/ssh-action@v1
              with:
                host:  ${{ secrets.IP_SERVER }}
                username: ${{ secrets.USERNAME  }}
                key: ${{ secrets.KEY }}
                port: ${{ secrets.PORT }}
                script: |
                        cd /home/ubuntu/java
                        docker compose down 
                        docker compose up -d --build 
              
